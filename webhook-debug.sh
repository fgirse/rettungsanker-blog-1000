#!/bin/bash

echo "üîç Webhook Debugging Guide"
echo "=========================="
echo ""
echo "1Ô∏è‚É£  Stellen Sie sicher, dass ngrok l√§uft:"
echo "   ngrok http 3000"
echo ""
echo "2Ô∏è‚É£  √úberpr√ºfen Sie die ngrok URL (z.B. https://5383b898b7ba.ngrok-free.app)"
echo ""
echo "3Ô∏è‚É£  Im Clerk Dashboard konfigurieren:"
echo "   - Dashboard ‚Üí Webhooks ‚Üí + Add Endpoint"
echo "   - URL: https://your-ngrok-url.ngrok.io/api/webhooks/clerk"
echo "   - Events: user.created, user.updated, user.deleted"
echo "   - Signing Secret kopieren"
echo ""
echo "4Ô∏è‚É£  .env.local aktualisieren:"
echo "   WEBHOOK_SECRET=whsec_xxxxx"
echo ""
echo "5Ô∏è‚É£  Terminal-Logs √ºberpr√ºfen (npm run dev sollte laufen)"
echo "   Suchen Sie nach:"
echo "   - 'üîî Webhook received from Clerk'"
echo "   - '‚úÖ User created/updated in MongoDB'"
echo "   - '‚ùå Fehler' (wenn es Probleme gibt)"
echo ""
echo "6Ô∏è‚É£  Test durchf√ºhren:"
echo "   - Erstellen Sie einen neuen Benutzer auf:"
echo "     https://5383b898b7ba.ngrok-free.app/sign-up"
echo "   - √úberpr√ºfen Sie die Terminal-Logs"
echo "   - F√ºhren Sie aus: node check-users.mjs"
echo ""
echo "7Ô∏è‚É£  Im Clerk Dashboard testen:"
echo "   - Webhooks ‚Üí Ihr Endpoint ‚Üí Send Test Event"
echo "   - W√§hlen Sie 'user.created'"
echo "   - Klicken Sie 'Send Test'"
echo "   - Terminal sollte zeigen: 'üîî Webhook received from Clerk'"
echo ""
echo "H√§ufige Fehler:"
echo "- '‚ùå WEBHOOK_SECRET is not set' ‚Üí .env.local pr√ºfen"
echo "- '‚ùå Missing svix headers' ‚Üí Webhook-Signatur falsch"
echo "- '‚ùå Signature verification failed' ‚Üí Wrong Secret"
echo "- '‚ùå Duplicate email/username' ‚Üí User existiert bereits"
echo ""
echo "MongoDB √ºberpr√ºfen:"
echo "   node check-users.mjs"
echo ""
